# ‚úÖ –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ - –í–°–Å –†–ê–ë–û–¢–ê–ï–¢!

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ö–æ–Ω—Ç–∞–∫—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ!** –°–∏—Å—Ç–µ–º–∞:

- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è —Å –ø—Ä–æ—Ñ–∏–ª–µ–º
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ –æ–±–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–∞–∫—Ç –ø—Ä–∏–Ω—è—Ç
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å (–∏–º—è, –∞–≤–∞—Ç–∞—Ä, –±–∏–æ)
- ‚úÖ –†–µ–Ω–¥–µ—Ä–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤ UI

---

## –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

### –ü–ï–†–í–´–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ (tutturu) - –û–¢–ü–†–ê–í–ò–¢–ï–õ–¨

#### –≠—Ç–∞–ø 1: –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

```
üìä Loaded 1 contacts for tutturu
üìä loadContacts actor: loaded 1 contacts from DB
‚úÖ Contacts machine entered ready state with 1 contacts
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** Machine –∑–∞–≥—Ä—É–∂–∞–µ—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–∞–∫—Ç –∏–∑ –ë–î

#### –≠—Ç–∞–ø 2: –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä

```
üìá sidebar-panel.render() hasContacts: true
üìá Rendering accepted contact: 2a1ee0d0...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç –≤ —Å—Ç–∞—Ç—É—Å–µ "accepted"  
**–ü–æ—á–µ–º—É accepted?** –ü–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∏–∑–∏—Ç –Ω–∞ —ç—Ç–æ—Ç –∞–∫–∫–∞—É–Ω—Ç –∏ –∫–æ–Ω—Ç–∞–∫—Ç —É–∂–µ –±—ã–ª –ø—Ä–∏–Ω—è—Ç —Ä–∞–Ω—å—à–µ

#### –≠—Ç–∞–ø 3: –ö–ª–∏–∫ –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç

```
üìá sidebar-panel: selecting contact 2a1ee0d0...
üêö Shell: Opening chat with 2a1ee0d0...
üêö _renderApp() called, _contactsActor: exists
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–∞—Ç —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º

---

### –í–¢–û–†–û–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ (kukusiki) - –ü–û–õ–£–ß–ê–¢–ï–õ–¨

#### –≠—Ç–∞–ø 1: –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

```
üìä Loaded 1 contacts for kukusiki
üìä loadContacts actor: loaded 1 contacts from DB
‚úÖ Contacts machine entered ready state with 1 contacts
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** Machine –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∏–∑ –ë–î  
**–°—Ç–∞—Ç—É—Å:** `pending_incoming` (–≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å)

#### –≠—Ç–∞–ø 2: –†–µ–Ω–¥–µ—Ä –≤—Ö–æ–¥—è—â–µ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

```
üìá sidebar-panel.render() grouped: { incoming: (1) [‚Ä¶], ... }
üìá Rendering incoming contact: 2597200b...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç –≤ –≥—Ä—É–ø–ø–µ "–í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã"

#### –≠—Ç–∞–ø 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ü–†–ò–ù–ò–ú–ê–ï–¢ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ

```
üìá sidebar-panel: accepting contact 2597200b...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–Ω—É–ª –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å"

#### –≠—Ç–∞–ø 4: –õ–æ–∫–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```
‚úÖ Contact updated: 2597200b...
‚úÖ Contact accepted: 2597200b...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- –ö–æ–Ω—Ç–∞–∫—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –ë–î (—Å—Ç–∞—Ç—É—Å ‚Üí `accepted`)
- –°–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∏–ª ACCEPT_INVITE –Ω–∞ —Å–µ—Ä–≤–µ—Ä

#### –≠—Ç–∞–ø 5: Machine –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã

```
üìä Loaded 1 contacts for kukusiki
‚úÖ Contacts machine entered ready state with 1 contacts
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** Machine –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ—Å–ª–µ accept

#### –≠—Ç–∞–ø 6: –†–µ–Ω–¥–µ—Ä –ø—Ä–∏–Ω—è—Ç–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞

```
üìá sidebar-panel.render() grouped: { incoming: [], ..., accepted: (1) [‚Ä¶] }
üìá Rendering accepted contact: 2597200b...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- –ö–æ–Ω—Ç–∞–∫—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª—Å—è –∏–∑ "–í—Ö–æ–¥—è—â–∏–µ" –≤ "–ö–æ–Ω—Ç–∞–∫—Ç—ã" ‚úÖ
- UI –æ–±–Ω–æ–≤–∏–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ

#### –≠—Ç–∞–ø 7: –û—Ç–∫—Ä—ã—Ç–∏–µ —á–∞—Ç–∞

```
üìá sidebar-panel: selecting contact 2597200b...
üêö Shell: Opening chat with 2597200b...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–∞—Ç —Å –ø—Ä–∏–Ω—è—Ç—ã–º –∫–æ–Ω—Ç–∞–∫—Ç–æ–º

#### –≠—Ç–∞–ø 8: –ü–ï–†–í–´–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

```
‚úÖ Invite accepted for: 2a1ee0d0...
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- Signaling –ø–æ–ª—É—á–∏–ª ACCEPT_INVITE —Å —Å–µ—Ä–≤–µ—Ä–∞
- –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ –ø–µ—Ä–≤–æ–º –∫–ª–∏–µ–Ω—Ç–µ

---

## –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –°—Ç–∞—Ç—É—Å—ã –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

**–ù–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ (tutturu):**

- `pending_outgoing` ‚Üí –∫–æ–Ω—Ç–∞–∫—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
- `accepted` ‚Üí –∫–æ–Ω—Ç–∞–∫—Ç –ø—Ä–∏–Ω—è–ª –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ ‚úÖ

**–ù–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ (kukusiki):**

- `pending_incoming` ‚Üí –ø–æ–ª—É—á–∏–ª –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
- `accepted` ‚Üí –ø—Ä–∏–Ω—è–ª –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ ‚úÖ

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

1. **–õ–æ–∫–∞–ª—å–Ω–æ:** –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ IndexedDB
2. **–ß–µ—Ä–µ–∑ signaling:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ —Å—Ç–∞—Ç—É—Å–∞
3. **Machine:** –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏–∑ –ë–î
4. **UI:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Lit

### –ü–æ—Ä—è–¥–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```
User clicks "Accept"
         ‚Üì
ContactsService.acceptContact()
         ‚Üì
status ‚Üí 'accepted'
contact ‚Üí DB (IndexedDB)
         ‚Üì
signalingActor.send(ACCEPT_INVITE)
         ‚Üì
Server ‚Üí Other client
         ‚Üì
handleInviteAccepted()
         ‚Üì
status ‚Üí 'accepted' on sender side
         ‚Üì
Machine reloads contacts
         ‚Üì
UI updates (Lit re-renders)
```

---

## –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ

‚úÖ **Multi-user isolation:** –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã  
‚úÖ **Composite keys:** `${username}:${contactId}` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã  
‚úÖ **Status tracking:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –Ω–∞ –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö  
‚úÖ **Profile sync:** –ò–º—è, –∞–≤–∞—Ç–∞—Ä, –±–∏–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è–º–∏  
‚úÖ **Event handling:** ACCEPT_INVITE –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å  
‚úÖ **UI updates:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏  
‚úÖ **Persistence:** –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ IndexedDB –∏ –≤—ã–∂–∏–≤–∞—é—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É

---

## –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (—á—Ç–æ –º—ã –≤–∏–¥–∏–º –≤ –ª–æ–≥–∞—Ö)

### CLIENT 1 (tutturu)

1. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç ‚Üí —Å—Ç–∞—Ç—É—Å `pending_outgoing`
2. ‚úÖ –í–∏–¥–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç –≤ —Å–ø–∏—Å–∫–µ –∫–∞–∫ "–ò—Å—Ö–æ–¥—è—â–∏–µ"
3. ‚úÖ CLIENT 2 –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
4. ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ `SIGNALING_INVITE_ACCEPTED`
5. ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ "–ö–æ–Ω—Ç–∞–∫—Ç—ã" (accepted)
6. ‚úÖ –ú–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç

### CLIENT 2 (kukusiki)

1. ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ ‚Üí —Å—Ç–∞—Ç—É—Å `pending_incoming`
2. ‚úÖ –í–∏–¥–∏—Ç –∫–æ–Ω—Ç–∞–∫—Ç –≤ —Å–ø–∏—Å–∫–µ –∫–∞–∫ "–í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã"
3. ‚úÖ –ù–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–∏–Ω—è—Ç—å"
4. ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚Üí —Å—Ç–∞—Ç—É—Å `accepted`
5. ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ "–ö–æ–Ω—Ç–∞–∫—Ç—ã"
6. ‚úÖ –ú–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞**:

- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∏ –ø–æ–ª—É—á–∞—é—Ç—Å—è
- –°—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –Ω–∞ –æ–±–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö
- –ü—Ä–æ—Ñ–∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
- –î–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–∏—Å—Ç–∏—Ä—É—é—Ç—Å—è –≤ IndexedDB
- UI –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

**–ë–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å!** üéâ
